<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>STARSEED - Top HUD</title>
    <style>
        body, html {
            margin: 0; padding: 0; width: 100%; height: 100%;
            background-color: #000; overflow: hidden;
            display: flex; justify-content: center; align-items: center;
            user-select: none; -webkit-user-select: none; touch-action: none;
        }
        #game-container {
            position: relative; width: 100vw; height: 100vh;
            max-width: 450px; max-height: 850px;
            display: flex; justify-content: center; align-items: center;
            background-color: #0d0d0d;
        }
        canvas {
            display: block; width: 100%; height: 100%;
            object-fit: contain; image-rendering: pixelated;
        }
    </style>
</head>
<body>

<div id="game-container"></div>

<script>
const container = document.getElementById('game-container');
const cvs = document.createElement("canvas");
const ctx = cvs.getContext("2d");

const gameWidth = 360;
const gameHeight = 640;
const dpr = window.devicePixelRatio || 1;

cvs.width = gameWidth * dpr;
cvs.height = gameHeight * dpr;
ctx.scale(dpr, dpr);

ctx.imageSmoothingEnabled = false;
container.appendChild(cvs);

// --- ASSETS ---
const bird1Img = new Image(); bird1Img.src = "bird.png"; 
const bird2Img = new Image(); bird2Img.src = "bird2.png"; 
const pipeImg = new Image(); pipeImg.src = "pillar.png"; 
const bgImg = new Image(); bgImg.src = "bg.png"; 

// AUDIO
const playlist = ["music.mp3", "music2.mp3", "music3.mp3", "music4.mp3"];
let currentTrackIndex = 0;
const music = new Audio();
music.src = playlist[currentTrackIndex];
music.loop = true;

const sound47 = new Audio();
sound47.src = "47.mp3";

// --- VARIABLES ---
let gamePlaying = false;
let isDead = false;
let frames = 0;
let score = 0;
let finalScore = 0;
let highScore = localStorage.getItem("starseedHighScore") || 0;

// UNLOCK SYSTEM
let bird2Unlocked = localStorage.getItem("bird2Unlocked") === "true";
let selectedBird = 1; 
let showUnlockAlert = false;
let unlockAlertTimer = 0;

// --- STARFIELD ---
const starfield = {
    particles: [],
    init: function() {
        for(let i = 0; i < 80; i++) { 
            this.particles.push({
                x: Math.random() * gameWidth,
                y: Math.random() * gameHeight,
                size: Math.random() * 0.9 + 0.4, 
                speed: Math.random() * 0.8 + 0.1,
                opacity: Math.random() 
            });
        }
    },
    draw: function() {
        for(let i = 0; i < this.particles.length; i++) {
            let p = this.particles[i];
            p.opacity += (Math.random() - 0.5) * 0.1;
            if(p.opacity < 0.2) p.opacity = 0.2;
            if(p.opacity > 1) p.opacity = 1;
            ctx.fillStyle = (i % 6 === 0) ? `rgba(40, 255, 40, ${p.opacity})` : `rgba(255, 255, 255, ${p.opacity})`;
            ctx.fillRect(p.x, p.y, p.size, p.size);
        }
    },
    update: function() {
        let globalSpeed = (gamePlaying || isDead) ? 2.5 : 0.3; 
        for(let p of this.particles) {
            p.x -= (p.speed * globalSpeed);
            if(p.x < 0) { p.x = gameWidth; p.y = Math.random() * gameHeight; }
        }
    }
};
starfield.init();

// --- BIRD ---
const bird = {
    x: 65, y: 280, w: 45, h: 55, speed: 0, gravity: 0.28, jump: 5.3,    
    draw: function() {
        let currentImg = (selectedBird === 1) ? bird1Img : bird2Img;
        if (currentImg.complete) { ctx.drawImage(currentImg, this.x, this.y, this.w, this.h); }
        else { ctx.fillStyle = "#28ff28"; ctx.fillRect(this.x, this.y, this.w, this.h); }
    },
    update: function() {
        if (!gamePlaying && !isDead) { this.y = 280 + Math.cos(frames/15) * 10; return; }
        if (isDead) return;
        this.speed += this.gravity;
        this.y += this.speed;
        if (this.y + this.h >= gameHeight || this.y <= 0) { gameOver(); }
    },
    flap: function() { this.speed = -this.jump; }
};

// --- PIPES ---
const pipes = {
    position: [], w: 55, h: 450, gap: 165, dx: 3.2, 
    draw: function() {
        for(let p of this.position){
            let topY = p.y;
            let bottomY = p.y + this.h + p.currentGap;
            ctx.save();
            ctx.shadowColor = "#FFFFFF"; ctx.shadowBlur = 12;
            if (pipeImg.complete) {
                ctx.save();
                ctx.translate(p.x + this.w / 2, topY + this.h / 2);
                ctx.scale(1, -1);
                ctx.drawImage(pipeImg, -this.w / 2, -this.h / 2, this.w, this.h);
                ctx.restore();
                ctx.drawImage(pipeImg, p.x, bottomY, this.w, this.h);
            }
            ctx.restore();
        }
    },
    update: function() {
        if(!gamePlaying) return;
        if(frames % 105 == 0){
            this.position.push({ x: gameWidth, y: Math.floor(Math.random() * (-160 - -340 + 1) + -340), currentGap: this.gap, scored: false });
        }
        for(let i = 0; i < this.position.length; i++){
            let p = this.position[i];
            p.x -= this.dx;
            if( bird.x + 12 < p.x + this.w && bird.x + bird.w - 12 > p.x && 
               (bird.y + 12 < p.y + this.h || bird.y + bird.h - 12 > p.y + this.h + p.currentGap)){
                gameOver(); return; 
            }
            if(p.x + this.w <= 0){ this.position.shift(); i--; } 
            else if (p.x + this.w < bird.x && !p.scored) {
                p.scored = true;
                score++;
                if (score === 47) {
                    sound47.play().catch(() => {});
                    if (!bird2Unlocked) {
                        bird2Unlocked = true;
                        localStorage.setItem("bird2Unlocked", "true");
                        showUnlockAlert = true;
                        unlockAlertTimer = 180; 
                    }
                }
                if (score % 10 === 0) { this.dx += 0.7; if (this.gap > 135) this.gap -= 5; }
            }
        }
    }
};

// --- ENGINE ---
function draw(){
    if (bgImg.complete) {
        let scale = Math.max(gameWidth / bgImg.width, gameHeight / bgImg.height);
        let x = (gameWidth / 2) - (bgImg.width / 2) * scale;
        let y = (gameHeight) - (bgImg.height * scale); 
        ctx.drawImage(bgImg, x, y, bgImg.width * scale, bgImg.height * scale);
    } else {
        ctx.fillStyle = "#000"; ctx.fillRect(0, 0, gameWidth, gameHeight);
    }
    
    starfield.draw(); 
    pipes.draw(); 
    bird.draw();

    if (gamePlaying) {
        ctx.fillStyle = "#28ff28"; ctx.font = "bold 38px Courier New";
        ctx.textAlign = "center"; ctx.fillText(score, gameWidth/2, 70);
    }

    if (showUnlockAlert) {
        ctx.fillStyle = "rgba(40, 255, 40, 0.9)";
        ctx.font = "bold 16px Courier New";
        ctx.textAlign = "center";
        ctx.fillText("NEW VESSEL SYNCED", gameWidth/2, gameHeight/2 - 100);
        if (bird2Img.complete) ctx.drawImage(bird2Img, gameWidth/2 - 15, gameHeight/2 - 90, 30, 40);
        unlockAlertTimer--;
        if (unlockAlertTimer <= 0) showUnlockAlert = false;
    }

    if(!gamePlaying && !isDead){
        // --- HUD MOVED TO TOP ---
        ctx.fillStyle = "rgba(255, 255, 255, 0.5)";
        ctx.font = "bold 14px Courier New";
        ctx.textAlign = "center";
        ctx.fillText("HIGH SCORE: " + highScore, gameWidth/2, 40);

        ctx.fillStyle = "#FFF";
        ctx.font = "bold 12px Courier New";
        ctx.fillText("SELECT VESSEL", gameWidth/2, 65);
        
        // Vessel Slot 1 (Moved up)
        ctx.strokeStyle = (selectedBird === 1) ? "#28ff28" : "#444";
        ctx.strokeRect(gameWidth/2 - 50, 80, 40, 50);
        if (bird1Img.complete) ctx.drawImage(bird1Img, gameWidth/2 - 45, 90, 30, 35);
        
        // Vessel Slot 2 (Moved up)
        if (bird2Unlocked) {
            ctx.strokeStyle = (selectedBird === 2) ? "#28ff28" : "#444";
            ctx.strokeRect(gameWidth/2 + 10, 80, 40, 50);
            if (bird2Img.complete) ctx.drawImage(bird2Img, gameWidth/2 + 15, 90, 30, 35);
        } else {
            ctx.fillStyle = "#333";
            ctx.fillRect(gameWidth/2 + 10, 80, 40, 50);
            ctx.fillStyle = "#666";
            ctx.font = "bold 10px Courier New";
            ctx.fillText("LOCKED", gameWidth/2 + 30, 110);
        }

        // --- CENTER PROMPT ---
        ctx.fillStyle = "rgba(40, 255, 40, 0.9)"; 
        ctx.font = "bold 22px Courier New";
        ctx.fillText("INITIATE SEQUENCE", gameWidth/2, gameHeight/2 + 50);
    }

    if(isDead){
        ctx.fillStyle = "rgba(0, 0, 0, 0.7)";
        ctx.fillRect(0, 0, gameWidth, gameHeight);
        ctx.fillStyle = "#28ff28"; ctx.font = "bold 24px Courier New";
        ctx.textAlign = "center"; ctx.fillText("SEQUENCE TERMINATED", gameWidth/2, gameHeight/2 - 40);
        ctx.fillStyle = "#FFF"; ctx.font = "bold 45px Courier New";
        ctx.fillText("SCORE: " + finalScore, gameWidth/2, gameHeight/2 + 20);
        ctx.fillStyle = "rgba(40, 255, 40, 0.8)"; ctx.font = "bold 16px Courier New";
        ctx.fillText("TAP TO RE-INITIATE", gameWidth/2, gameHeight/2 + 85);
    }
}

function loop(){ starfield.update(); bird.update(); pipes.update(); draw(); frames++; requestAnimationFrame(loop); }

function gameOver(){
    gamePlaying = false; isDead = true; finalScore = score;
    if(score > highScore) { highScore = score; localStorage.setItem("starseedHighScore", highScore); }
    music.pause(); music.currentTime = 0;
    currentTrackIndex = (currentTrackIndex + 1) % playlist.length;
    music.src = playlist[currentTrackIndex];
}

function handleAction(e) {
    if (e && e.type === "touchstart") e.preventDefault();
    
    if (!gamePlaying && !isDead) {
        let touchX, touchY;
        const rect = cvs.getBoundingClientRect();
        if (e.type === "touchstart") {
            touchX = (e.touches[0].clientX - rect.left) * (gameWidth / rect.width);
            touchY = (e.touches[0].clientY - rect.top) * (gameHeight / rect.height);
        } else {
            touchX = (e.clientX - rect.left) * (gameWidth / rect.width);
            touchY = (e.clientY - rect.top) * (gameHeight / rect.height);
        }

        // --- UPDATED TOUCH COORDINATES FOR TOP MENU ---
        if (touchX > gameWidth/2 - 50 && touchX < gameWidth/2 - 10 && touchY > 80 && touchY < 130) {
            selectedBird = 1; return;
        }
        if (bird2Unlocked && touchX > gameWidth/2 + 10 && touchX < gameWidth/2 + 50 && touchY > 80 && touchY < 130) {
            selectedBird = 2; return;
        }
    }

    if(isDead) {
        isDead = false; bird.y = 280; bird.speed = 0; pipes.position = [];
        pipes.dx = 3.2; pipes.gap = 165; score = 0; frames = 0; return;
    }
    if(!gamePlaying){ gamePlaying = true; music.play().catch(() => {}); }
    bird.flap();
}

window.addEventListener("mousedown", handleAction);
window.addEventListener("touchstart", handleAction, { passive: false }); 
window.addEventListener("keydown", (e) => { if(e.code === "Space") handleAction(); });

loop();
</script>
</body>
</html>
